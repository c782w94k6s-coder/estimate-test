<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>かもがわ年間パックお見積り</title>

<style>
:root{
  --main-green:#0b6b3a;
  --sub-green:#e6f2ec;
  --border-green:#9ccbb6;
}
body{
  font-family:sans-serif;
  max-width:720px;
  margin:20px auto;
}
.wrapper{
  border:2px solid var(--border-green);
  border-radius:10px;
  padding:20px;
}
h2{
  background:var(--main-green);
  color:#fff;
  padding:12px;
  border-radius:6px;
  text-align:center;
}
label{
  font-weight:bold;
  display:block;
  margin-top:16px;
}
select,input{
  width:100%;
  padding:6px;
  margin-top:6px;
}
.small{font-size:12px;color:#555;}
.hidden{display:none;}
.box{
  border:1px solid #ccc;
  padding:10px;
  margin-top:10px;
}
button{
  margin-top:20px;
  width:100%;
  padding:12px;
  font-size:16px;
}
#result{
  margin-top:20px;
  background:var(--sub-green);
  padding:14px;
  border-radius:8px;
  font-size:18px;
  font-weight:bold;
}
  .pattern-card{
  display:block;
  border:1px solid #ccc;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  cursor:pointer;
}
.pattern-card:hover{
  background:#f5f5f5;
}
.pattern-card input{
  margin-right:6px;
}
</style>
</head>

<body>
<div class="wrapper">
<h2>かもがわ年間パックお見積り</h2>

<label>動物</label>
<select id="animal">
  <option value="">選択してください</option>
  <option value="dog">犬</option>
  <option value="cat">猫</option>
</select>

<label>体重（kg）</label>
<input type="number" id="weight" step="0.1">

<label>健診コース</label>
<select id="course">
  <option value="">選択してください</option>
  <option value="light">ライト</option>
  <option value="standard">スタンダード</option>
  <option value="premium">プレミアム</option>
  <option value="ct">CTコース</option>
</select>
  
<div id="ct-note" class="small hidden" style="color:#b00000;">
※CTコースは別途 読影料・静脈留置代・点滴代がかかります<br>
※体重・体格・性格により全身麻酔または鎮静が必要な場合があります
</div>

<label>予防期間</label>
<select id="planSel"></select>

  <div id="method-area" class="box hidden">
  <label>予防方法</label>
  <input type="radio" name="method" value="combo" checked> 1種類で予防する
  <br>
  <input type="radio" name="method" value="separate"> 2種類で予防する
</div>

<!-- 犬Bプラン パターン -->
<div id="dog-pattern" class="box hidden">
  <label>Bプランの予防方法</label>

  <label class="pattern-card">
    <input type="radio" name="bpattern" value="p1" checked>
    <strong>パターン①（別々で予防）</strong><br>
    フィラリア8ヶ月<br>
    ノミダニ12ヶ月<br>
    <span class="small">→ 王道パターン</span>
  </label>

  <label class="pattern-card">
    <input type="radio" name="bpattern" value="p2">
    <strong>パターン②（総合＋追加）</strong><br>
    ノミダニ＋フィラリア8ヶ月<br>
    ノミダニ4ヶ月追加<br>
    <span class="small">→ 投薬回数を減らしたい方向け</span>
  </label>
</div>

<!-- 犬 総合 -->
<div id="combo-area" class="box hidden">
  <label>総合予防薬</label>
  <select id="combo-med">
    <option value="cred">クレデリオプラス(タブレットタイプ)</option>
    <option value="nexsp">ネクスガードスペクトラ(キューブタイプ)</option>
  </select>
</div>

<!-- 犬 別々 -->
<div id="separate-area" class="box hidden">
  <label>ノミダニ予防薬</label>
  <select id="flea-med">
    <option value="effipro">エフィプロデュオ(スポットタイプ)</option>
    <option value="nex">ネクスガード(キューブタイプ)</option>
  </select>

  <label style="margin-top:10px;">フィラリア予防薬</label>
  <select id="heart-med">
    <option value="iver">イベルメック(おやつタイプ)</option>
  </select>
</div>

<!-- 猫 -->
<div id="cat-area" class="box hidden">
  <label>猫の予防薬</label>
  <select id="cat-med">
    <option value="rev">レボリューションプラス(スポットタイプ)</option>
    <option value="catcombo">ネクスガードキャットコンボ(スポットタイプ)</option>
  </select>
</div>

<button onclick="calc()">見積もり計算</button>

<div id="result"></div>
<div id="detail" class="small"></div>
</div>

<script>
/* ===== DOM ===== */
const animal   = document.getElementById("animal");
const planSel  = document.getElementById("planSel");
const course   = document.getElementById("course");
const weight   = document.getElementById("weight");
const result   = document.getElementById("result");
const detailEl = document.getElementById("detail");

/* ===== 単価 ===== */
const prices={
  effipro:[[10,1400],[20,1700],[40,1900]],
  nex:[[4.5,1600],[11,1800],[27,2000],[55,2300]],
  iver:[[5.6,1000],[11.3,1300],[22.6,1800],[45.3,2200]],
  cred:[[2.8,2200],[5.5,2300],[11,2800],[22,3500],[45,4000]],
  nexsp:[[3.6,3000],[7.5,3400],[15,3800],[30,4400],[60,4700]],
  rev:[[2.5,1700],[5,1800],[10,1900]],
  catcombo:[[2.5,1100],[7.5,1200]]
};

function getPrice(list,w){
  for(const i of list){
    if(w<=i[0]) return i[1];
  }
  return 0;
}

/* ===== 健診 ===== */
function checkup(course,w){
  if(course==="light") return 7700;
  if(course==="standard"){
    if(w<=10) return 18700;
    if(w<=20) return 20900;
    if(w<=40) return 23100;
    return 25300;
  }
  if(course==="premium"){
    if(w<=10) return 36300;
    if(w<=20) return 38500;
    if(w<=40) return 44000;
    return 49500;
  }
  if(course==="ct"){
  if(w <= 10) return 41700;

  // 10kg超えた分を10kg単位で加算
  const extra = Math.ceil((w - 10) / 10) * 10000;
  return 41700 + extra;
}
  return 0;
}

/* ===== UI制御 ===== */
document.addEventListener("DOMContentLoaded",function(){
  
const animal = document.getElementById("animal");
const course = document.getElementById("course");
const planSel = document.getElementById("plan");
  
  function resetPrevention(){
  // 予防方法リセット（1種類に戻す）
  document.querySelector("input[name='method'][value='combo']").checked = true;
  // Bパターンも①に戻す
  document.querySelector("input[name='bpattern'][value='p1']").checked = true;
}
  animal.onchange = function(){
   resetPrevention();
    createPlans();
  updateUI();
};
  course.onchange=updateUI;

  planSel.onchange=function(){
    resetPrevention();
    updateUI();
  };
  document.querySelectorAll("input[name='method']").forEach(r=>{
  r.onchange = updateUI;
});
  document.querySelectorAll("input[name='bpattern']").forEach(r=>{
  r.onchange = updateUI;
});
function createPlans(){
  planSel.innerHTML = "";
// 予防期間
  if(animal.value==="dog"){
    [
      ["A","フィラリア8＋ノミダニ8"],
      ["B","フィラリア8＋ノミダニ12"],
      ["C","フィラリア12＋ノミダニ12"]
    ].forEach(p=>{
      const o=document.createElement("option");
      o.value=p[0];
      o.textContent=`${p[0]}：${p[1]}`;
      planSel.appendChild(o);
    });
  }

  if(animal.value==="cat"){
    [
      ["A","8ヶ月"],
      ["B","12ヶ月"]
    ].forEach(p=>{
      const o=document.createElement("option");
      o.value=p[0];
      o.textContent=`${p[0]}：${p[1]}`;
      planSel.appendChild(o);
    });
  }
}
function updateUI(){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));

  // CT注意
  document.getElementById("ct-note")
    .classList.toggle("hidden", course.value!=="ct");

  // 猫
  if(animal.value==="cat"){
    document.getElementById("cat-area").classList.remove("hidden");
  }

  // 犬
  if(animal.value==="dog"){

    if(planSel.value==="A" || planSel.value==="C"){
      document.getElementById("method-area").classList.remove("hidden");

      const m=document.querySelector("input[name='method']:checked").value;

      document.getElementById(
        m==="combo" ? "combo-area" : "separate-area"
      ).classList.remove("hidden");
    }

    if(planSel.value==="B"){
      document.getElementById("dog-pattern").classList.remove("hidden");

      const pat=document.querySelector("input[name='bpattern']:checked").value;

      if(pat==="p1"){
        document.getElementById("separate-area").classList.remove("hidden");
      }else{
        document.getElementById("combo-area").classList.remove("hidden");
        document.getElementById("separate-area").classList.remove("hidden");
      }
    }
  }
}
/* ===== 計算 ===== */
function calc(){
  const w = Number(weight.value);
  if(!animal.value || !course.value || !w){
    alert("未選択があります");
    return;
  }

  let total = checkup(course.value,w);
  let detail = [`健診：${total.toLocaleString()}円`];

  if(animal.value==="dog"){
    const flea = getPrice(prices[document.getElementById("flea-med").value], w);
    const heart = getPrice(prices.iver, w);
    const combo = getPrice(prices[document.getElementById("combo-med").value], w);

    if(planSel.value==="A"){
      total += flea*7 + heart*7;
      detail.push("犬A：フィラリア8＋ノミダニ8");
    }
    if(planSel.value==="B"){
  const pat = document.querySelector("input[name='bpattern']:checked").value;

  if(pat==="p1"){
    // パターン①
    total += heart * 7;   // フィラリア8ヶ月（1個割引）
    total += flea * 10;   // ノミダニ12ヶ月（2個割引）
    detail.push("犬B①：フィラリア8＋ノミダニ12");
  }else{
    // パターン②
    total += combo * 7;   // 総合8ヶ月（1個割引）
    total += flea * 3;    // ノミダニ4ヶ月（1個割引）
    detail.push("犬B②：総合8＋ノミダニ4");
  }
}
    if(planSel.value==="C"){
      total += flea*10 + heart*10;
      detail.push("犬C：フィラリア12＋ノミダニ12");
    }
  }

  if(animal.value==="cat"){
    const catMed=document.getElementById("cat-med").value;
    const p=getPrice(prices[catMed],w);
    total+=p*(planSel.value==="A"?7:11);
    detail.push("猫：年間まとめ");
  }

  result.textContent=`合計（税抜）：${total.toLocaleString()}円`;
  detailEl.innerHTML=detail.join("<br>");
}

createPlans();
updateUI();
});
</body>
</script>
</html>
