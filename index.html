<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>健診＋予防薬 見積もり</title>
<style>
body {
  font-family: system-ui;
  max-width: 600px;
  margin: auto;
  padding: 20px;
}
select, input, button {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
}
.result {
  background: #f3f3f3;
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
}
</style>
</head>
<body>

<h2>健診＋予防薬 見積もり</h2>

<label>動物</label>
<select id="animal">
  <option value="">選択してください</option>
  <option value="dog">犬</option>
  <option value="cat">猫</option>
</select>

<label>体重（kg）</label>
<input type="number" id="weight" step="0.1">

<label>健診コース</label>
<select id="checkup">
  <option value="light">ライト</option>
  <option value="standard">スタンダード</option>
  <option value="premium">プレミアム</option>
</select>

<!-- 犬 -->
<div id="dog-area" style="display:none;">
  <label>予防薬プラン（犬）</label>
  <select id="dog-plan">
    <option value="A">A：8＋8ヶ月</option>
    <option value="B">B：12＋8ヶ月</option>
    <option value="C">C：12＋12ヶ月</option>
  </select>
</div>

<!-- 猫 -->
<div id="cat-area" style="display:none;">
  <label>ノミ・マダニ（月数）</label>
  <select id="cat-months">
    <option value="8">8ヶ月</option>
    <option value="12">12ヶ月</option>
  </select>
</div>

<button onclick="calc()">見積もり計算</button>

<div class="result" id="result"></div>

<script>
// 仮単価（後で差し替え）
const price = {
  dog: {
    filaria: [{ max: 45.3, price: 2200 }],
    flea: [{ max: 40, price: 1900 }]
  },
  cat: {
    flea: [{ max: 10, price: 1900 }]
  }
};

const checkupFee = {
  light: 15000,
  standard: 20000,
  premium: 35000
};

const dogPlans = {
  A: { flea: 8, filaria: 8, discount: 1 },
  B: { flea: 12, filaria: 8, discount: 1 },
  C: { flea: 12, filaria: 12, discount: 2 }
};

const animalEl = document.getElementById("animal");
const dogArea = document.getElementById("dog-area");
const catArea = document.getElementById("cat-area");

animalEl.addEventListener("change", () => {
  dogArea.style.display = animalEl.value === "dog" ? "block" : "none";
  catArea.style.display = animalEl.value === "cat" ? "block" : "none";
});

function getPrice(list, weight) {
  return list.find(p => weight <= p.max)?.price;
}

function calc() {
  const animal = animalEl.value;
  const weight = Number(document.getElementById("weight").value);
  const checkup = document.getElementById("checkup").value;

  if (!animal || !weight) {
    alert("動物と体重を入力してください");
    return;
  }

  let medTotal = 0;
  let prices = [];
  let discountCount = 0;

  if (animal === "dog") {
    const plan = document.getElementById("dog-plan").value;
    const p = dogPlans[plan];

    const fleaP = getPrice(price.dog.flea, weight);
    const filP = getPrice(price.dog.filaria, weight);
    if (!fleaP || !filP) return alert("体重区分外です");

    medTotal = fleaP * p.flea + filP * p.filaria;
    prices = [fleaP, filP];
    discountCount = p.discount;

  } else {
    const months = Number(document.getElementById("cat-months").value);
    const fleaP = getPrice(price.cat.flea, weight);
    if (!fleaP) return alert("体重区分外です");

    medTotal = fleaP * months;
    prices = [fleaP];
    discountCount = months === 12 ? 2 : 1;
  }

  const discount = Math.max(...prices) * discountCount;
  const total = checkupFee[checkup] + medTotal - discount;

  result.innerHTML = `
    <p>健診料金：¥${checkupFee[checkup].toLocaleString()}</p>
    <p>予防薬合計：¥${medTotal.toLocaleString()}</p>
    <p>割引：${discountCount}個分</p>
    <hr>
    <strong>合計：¥${total.toLocaleString()}</strong>
  `;
}
</script>

</body>
</html>