<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>健診＋予防薬 見積もり</title>
<style>
  body {
    font-family: system-ui;
    max-width: 600px;
    margin: auto;
    padding: 20px;
  }
  select, input, button {
    width: 100%;
    padding: 8px;
    margin: 6px 0;
    font-size: 16px;
  }
  .result {
    background: #f3f3f3;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
  }
</style>
</head>
<body>

<h2>健診＋予防薬 見積もり</h2>

<label>動物</label>
<select id="animal">
  <option value="">選択してください</option>
  <option value="dog">犬</option>
  <option value="cat">猫</option>
</select>

<label>体重（kg）</label>
<input type="number" id="weight" step="0.1">

<label>健診コース</label>
<select id="checkup">
  <option value="light">ライト</option>
  <option value="standard">スタンダード</option>
  <option value="premium">プレミアム</option>
</select>

<label>予防プラン</label>
<select id="plan"></select>

<button onclick="calc()">見積もり計算</button>

<div class="result" id="result"></div>

<script>
// =======================
// 仮単価（あとで差し替え）
// =======================
const price = {
  dog: {
    filaria: [
      { max: 45.3, price: 2200 } // イベルメック
    ],
    flea: [
      { max: 40, price: 1900 } // エフィプロデュオ
    ]
  },
  cat: {
    flea: [
      { max: 10, price: 1900 } // レボリューションプラス
    ]
  }
};

const checkupFee = {
  light: 15000,
  standard: 20000,
  premium: 35000
};

const plans = {
  dog: {
    A: { flea: 8, filaria: 8, discount: 1 },
    B: { flea: 12, filaria: 8, discount: 1 },
    C: { flea: 12, filaria: 12, discount: 2 }
  },
  cat: {
    A: { flea: 8, discount: 1 },
    B: { flea: 12, discount: 2 }
  }
};

const animalEl = document.getElementById("animal");
const planEl = document.getElementById("plan");

animalEl.addEventListener("change", () => {
  planEl.innerHTML = "";
  const a = animalEl.value;
  if (!a) return;

  Object.keys(plans[a]).forEach(p => {
    planEl.innerHTML += `<option value="${p}">プラン${p}</option>`;
  });
});

function getPrice(list, weight) {
  return list.find(p => weight <= p.max)?.price;
}

function calc() {
  const animal = animalEl.value;
  const weight = Number(document.getElementById("weight").value);
  const plan = planEl.value;
  const checkup = document.getElementById("checkup").value;

  if (!animal || !weight || !plan) {
    alert("すべて選択してください");
    return;
  }

  let medTotal = 0;
  let prices = [];

  if (animal === "dog") {
    const f = getPrice(price.dog.filaria, weight);
    const n = getPrice(price.dog.flea, weight);
    if (!f || !n) return alert("体重区分外です");

    medTotal = f * plans.dog[plan].filaria + n * plans.dog[plan].flea;
    prices = [f, n];
  } else {
    const c = getPrice(price.cat.flea, weight);
    if (!c) return alert("体重区分外です");

    medTotal = c * plans.cat[plan].flea;
    prices = [c];
  }

  const discountCount = plans[animal][plan].discount;
  const discount = Math.max(...prices) * discountCount;

  const total = checkupFee[checkup] + medTotal - discount;

  result.innerHTML = `
    <p>健診料金：¥${checkupFee[checkup].toLocaleString()}</p>
    <p>予防薬合計：¥${medTotal.toLocaleString()}</p>
    <p>割引：${discountCount}個分</p>
    <hr>
    <strong>合計：¥${total.toLocaleString()}</strong>
  `;
}
</script>

</body>
</html>