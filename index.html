<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>健診・予防薬 見積もり</title>
<style>
body{font-family:sans-serif;max-width:680px;margin:20px auto;}
label{font-weight:bold;display:block;margin-top:16px;}
select,input{width:100%;padding:6px;margin-top:6px;}
.small{font-size:12px;color:#555;}
.hidden{display:none;}
.box{border:1px solid #ccc;padding:10px;margin-top:10px;}
button{margin-top:20px;width:100%;padding:10px;font-size:16px;}
#result{margin-top:20px;font-size:18px;font-weight:bold;}
</style>
</head>

<body>
<h2>健診・予防薬 見積もり</h2>

<label>動物</label>
<select id="animal">
  <option value="">選択してください</option>
  <option value="dog">犬</option>
  <option value="cat">猫</option>
</select>

<label>体重（kg）</label>
<input type="number" id="weight" step="0.1">
<div class="small">※直近の体重を入力してください</div>

<label>健診コース</label>
<select id="course">
  <option value="">選択してください</option>
  <option value="light">ライト</option>
  <option value="standard">スタンダード</option>
  <option value="premium">プレミアム</option>
</select>

<!-- 犬：予防薬の種類 -->
<div id="dog-type-area" class="box hidden">
  <label>予防薬の種類</label>

  <input type="radio" name="dogtype" value="combo" checked>
  ノミダニ＋フィラリア【1種類で予防】
  <div class="small">※1種類でまとめて予防します</div><br>

  <input type="radio" name="dogtype" value="separate">
  ノミダニ予防薬＋フィラリア予防薬【2種類で予防】
  <div class="small">※それぞれ別のお薬を使用します</div>

  <div class="small">※迷った場合はスタッフにお声がけください</div>
</div>

<!-- 犬：総合 -->
<div id="combo-area" class="box hidden">
  <label>総合予防薬</label>
  <select id="combo-med">
    <option value="cred">クレデリオプラス（タブレットタイプ）</option>
    <option value="nexsp">ネクスガードスペクトラ（キューブタイプ）</option>
  </select>
</div>

<!-- 犬：別々 -->
<div id="separate-area" class="box hidden">
  <label>ノミ・マダニ予防薬</label>
  <select id="flea-med">
    <option value="effipro">エフィプロデュオ（スポットタイプ）</option>
    <option value="nex">ネクスガード（食べるタイプ）</option>
  </select>

  <label style="margin-top:10px;">フィラリア予防薬</label>
  <select disabled>
    <option>イベルメック（食べるタイプ）</option>
  </select>
</div>

<label>予防期間</label>
<select id="plan"></select>
<div class="small">※まとめて購入で割引が適用されます</div>

<button onclick="calc()">見積もり計算</button>
<div id="result"></div>
<div id="detail" class="small"></div>

<p class="small" style="margin-top:20px;">
※表示金額は目安（税抜）です<br>
※体重や薬剤変更により金額が前後する場合があります<br>
※最終金額は診察・会計時に確定します
</p>

<script>
// ===== 単価 =====
const prices={
  cred:[[2.8,2200],[5.5,2300],[11,2800],[22,3500],[45,4000]],
  nexsp:[[3.6,3000],[7.5,3400],[15,3800],[30,4400],[60,4700]],
  effipro:[[10,1400],[20,1700],[40,1900]],
  nex:[[4.5,1600],[11,1800],[27,2000],[55,2300]],
  iver:[[5.6,1000],[11.3,1300],[22.6,1800],[45.3,2200]],
  cat:[[2.5,1700],[5,1800],[10,1900]]
};

// ===== 健診料金 =====
function checkup(course,w){
  if(course==="light") return 7700;
  if(course==="standard"){
    if(w<=10) return 18700;
    if(w<=20) return 20900;
    if(w<=40) return 23100;
    return 25300;
  }
  if(course==="premium"){
    if(w<=10) return 36300;
    if(w<=20) return 38500;
    if(w<=40) return 44000;
    return 49500;
  }
  return 0;
}

// ===== プラン =====
const plans = {
  combo: {
    A: { label: "A：8ヶ月", m: 8, d: 1 },
    C: { label: "C：12ヶ月", m: 12, d: 2 }
  },
  separate: {
    A: { label: "A：ノミダニ8ヶ月／フィラリア8ヶ月", f: 8, fi: 8, d: 1 },
    B: { label: "B：ノミダニ12ヶ月／フィラリア8ヶ月", f: 12, fi: 8, d: 1 },
    C: { label: "C：ノミダニ12ヶ月／フィラリア12ヶ月", f: 12, fi: 12, d: 2 }
  },
  cat: {
    A: { label: "A：8ヶ月", m: 8, d: 1 },
    B: { label: "B：12ヶ月", m: 12, d: 2 }
  }
};

function getPrice(list,w){
  for(const i of list){
    if(w<=i[0]) return i[1];
  }
  return 0;
}

// ===== UI制御 =====
const animal=document.getElementById("animal");
const planSel=document.getElementById("plan");
animal.onchange=updateUI;
document.querySelectorAll("input[name='dogtype']")
  .forEach(r=>r.onchange=updateUI);

function updateUI(){
  planSel.innerHTML="";
  document.getElementById("dog-type-area").classList.add("hidden");
  document.getElementById("combo-area").classList.add("hidden");
  document.getElementById("separate-area").classList.add("hidden");

  if(animal.value==="dog"){
    document.getElementById("dog-type-area").classList.remove("hidden");
    const type=document.querySelector("input[name='dogtype']:checked").value;

    if(type==="combo"){
      document.getElementById("combo-area").classList.remove("hidden");
      addPlans(["A","C"], plans.combo);
    }else{
      document.getElementById("separate-area").classList.remove("hidden");
      addPlans(["A","B","C"], plans.separate);
    }
  }

  if(animal.value==="cat"){
    addPlans(["A","B"], plans.cat);
  }
}

// ===== 予防期間表示 =====
function addPlans(keys, planSet){
  keys.forEach(k=>{
    const o=document.createElement("option");
    o.value=k;
    o.textContent=planSet[k].label;
    planSel.appendChild(o);
  });
}

// ===== 計算 =====
function calc(){

  if(!animal.value || !course.value || !planSel.value){
    alert("動物・健診コース・予防期間を選択してください");
    return;
  }

  const w=Number(weight.value);
  let total=0;
  let detail=[];
  let discountMsg="";

  // 健診
  const check = checkup(course.value,w);
  total += check;
  detail.push("健診：" + check.toLocaleString() + "円");

  // ===== 犬 =====
  if(animal.value==="dog"){
    const type=document.querySelector("input[name='dogtype']:checked").value;

    if(type==="combo"){
      const p=getPrice(prices[document.getElementById("combo-med").value],w);
      const d=plans.combo[planSel.value];
      const sub = p*d.m - p*d.d;

      total += sub;
      detail.push("予防薬（総合）：" + sub.toLocaleString() + "円");
      discountMsg = "まとめ買いで " + d.d + "個分お得！";

    }else{
      const f=getPrice(prices[document.getElementById("flea-med").value],w);
      const fi=getPrice(prices.iver,w);
      const d=plans.separate[planSel.value];
      const sub = f*d.f + fi*d.fi - (f+fi)*d.d;

      total += sub;
      detail.push("ノミダニ予防薬＋フィラリア予防薬：" + sub.toLocaleString() + "円");
      discountMsg = "まとめ買いで " + d.d + "個分お得！";
    }
  }

  // ===== 猫 =====
  if(animal.value==="cat"){
    const p=getPrice(prices.cat,w);
    const d=plans.cat[planSel.value];
    const sub = p*d.m - p*d.d;

    total += sub;
    detail.push("予防薬：" + sub.toLocaleString() + "円");
    discountMsg = "まとめ買いで " + d.d + "個分お得！";
  }

  // ===== 表示 =====
  document.getElementById("result").textContent =
    "合計（税抜）： " + total.toLocaleString() + " 円";

  document.getElementById("detail").innerHTML =
    detail.join("<br>") + "<br><b>" + discountMsg + "</b>";
}

updateUI();
</script>
</body>
</html>